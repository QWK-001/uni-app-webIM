{"version":3,"sources":["webpack:////Users/lr/Documents/work/webim-weixin-xcx-ectype_uni/comps/chat/inputbar/suit/image/image.vue?53a9","webpack:////Users/lr/Documents/work/webim-weixin-xcx-ectype_uni/comps/chat/inputbar/suit/image/image.vue?1148","webpack:////Users/lr/Documents/work/webim-weixin-xcx-ectype_uni/comps/chat/inputbar/suit/image/image.vue?eb3d","webpack:////Users/lr/Documents/work/webim-weixin-xcx-ectype_uni/comps/chat/inputbar/suit/image/image.vue?0117","webpack:////Users/lr/Documents/work/webim-weixin-xcx-ectype_uni/comps/chat/inputbar/suit/image/image.vue"],"names":["WebIM","require","msgType","disp","data","components","props","username","type","Object","default","chatType","String","SINGLE_CHAT","methods","openCamera","me","wx","chooseImage","count","sizeType","sourceType","success","res","upLoadImage","sendImage","isGroupChat","CHAT_ROOM","getSendToParam","groupId","your","tempFilePaths","token","conn","context","accessToken","getImageInfo","src","allowType","jpg","gif","png","bmp","str","config","appkey","split","width","height","index","path","lastIndexOf","filetype","slice","toLowerCase","uploadFile","url","filePath","name","header","Authorization","dataObj","JSON","parse","id","getUniqueId","msg","message","IMAGE","file","size","uri","entities","uuid","filename","set","apiUrl","apiURL","body","from","myName","to","roomType","argument","fire","setGroup","send","$emit","bubbles","composed","setData","obj","callback","that","keys","val","forEach","key","$data","key2","length","$set"],"mappings":"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","file":"comps/chat/inputbar/suit/image/image.js","sourcesContent":["import { render, staticRenderFns } from \"./image.vue?vue&type=template&id=60a3a8a2&\"\nimport script from \"./image.vue?vue&type=script&lang=js&\"\nexport * from \"./image.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!module.hot.data) {\n      api.createRecord('60a3a8a2', component.options)\n    } else {\n      api.reload('60a3a8a2', component.options)\n    }\n    module.hot.accept(\"./image.vue?vue&type=template&id=60a3a8a2&\", function () {\n      api.rerender('60a3a8a2', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"Users/lr/Documents/work/webim-weixin-xcx-ectype_uni/comps/chat/inputbar/suit/image/image.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-custom-block-loader/index.js??ref--0-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./image.vue?vue&type=template&id=60a3a8a2&\"","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import mod from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-custom-block-loader/index.js??ref--0-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./image.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-custom-block-loader/index.js??ref--0-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./image.vue?vue&type=script&lang=js&\"","\nlet WebIM = require(\"../../../../../utils/WebIM\")[\"default\"];\nlet msgType = require(\"../../../msgtype\");\nlet disp = require(\"../../../../../utils/broadcast\");\n\nexport default {\n  data() {\n    return {};\n  },\n\n  components: {},\n  props: {\n    username: {\n      type: Object,\n      default: () => ({})\n    },\n    chatType: {\n      type: String,\n      default: msgType.chatType.SINGLE_CHAT\n    }\n  },\n  methods: {\n    openCamera() {\n      var me = this;\n      wx.chooseImage({\n        count: 1,\n        sizeType: [\"original\", \"compressed\"],\n        sourceType: [\"camera\"],\n\n        success(res) {\n          me.upLoadImage(res);\n        }\n\n      });\n    },\n\n    sendImage() {\n      var me = this;\n      wx.chooseImage({\n        count: 1,\n        sizeType: [\"original\", \"compressed\"],\n        sourceType: [\"album\"],\n\n        success(res) {\n          me.upLoadImage(res);\n        }\n\n      });\n    },\n\n    isGroupChat() {\n      return this.chatType == msgType.chatType.CHAT_ROOM;\n    },\n\n    getSendToParam() {\n      return this.isGroupChat() ? this.username.groupId : this.username.your;\n    },\n\n    upLoadImage(res) {\n      var me = this;\n      var tempFilePaths = res.tempFilePaths;\n      var token = WebIM.conn.context.accessToken;\n      wx.getImageInfo({\n        src: res.tempFilePaths[0],\n\n        success(res) {\n          var allowType = {\n            jpg: true,\n            gif: true,\n            png: true,\n            bmp: true\n          };\n          var str = WebIM.config.appkey.split(\"#\");\n          var width = res.width;\n          var height = res.height;\n          var index = res.path.lastIndexOf(\".\");\n          var filetype = ~index && res.path.slice(index + 1) || \"\";\n\n          if (filetype.toLowerCase() in allowType) {\n            wx.uploadFile({\n              url: \"https://a1.easemob.com/\" + str[0] + \"/\" + str[1] + \"/chatfiles\",\n              filePath: tempFilePaths[0],\n              name: \"file\",\n              header: {\n                \"Content-Type\": \"multipart/form-data\",\n                Authorization: \"Bearer \" + token\n              },\n\n              success(res) {\n                var data = res.data;\n                var dataObj = JSON.parse(data);\n                var id = WebIM.conn.getUniqueId(); // 生成本地消息 id\n\n                var msg = new WebIM.message(msgType.IMAGE, id);\n                var file = {\n                  type: msgType.IMAGE,\n                  size: {\n                    width: width,\n                    height: height\n                  },\n                  url: dataObj.uri + \"/\" + dataObj.entities[0].uuid,\n                  filetype: filetype,\n                  filename: tempFilePaths[0]\n                };\n                msg.set({\n                  apiUrl: WebIM.config.apiURL,\n                  body: file,\n                  from: me.username.myName,\n                  to: me.getSendToParam(),\n                  roomType: false,\n                  chatType: me.chatType,\n                  success: function (argument) {\n                    disp.fire('em.chat.sendSuccess', id);\n                  }\n                });\n\n                if (me.chatType == msgType.chatType.CHAT_ROOM) {\n                  msg.setGroup(\"groupchat\");\n                }\n\n                WebIM.conn.send(msg.body);\n                me.$emit(\"newImageMsg\", {\n                  msg: msg,\n                  type: msgType.IMAGE\n                }, {\n                  bubbles: true,\n                  composed: true\n                });\n              }\n\n            });\n          }\n        }\n\n      });\n    },\n\n    setData: function (obj, callback) {\n      let that = this;\n      let keys = [];\n      let val, data;\n      Object.keys(obj).forEach(function (key) {\n        keys = key.split('.');\n        val = obj[key];\n        data = that.$data;\n        keys.forEach(function (key2, index) {\n          if (index + 1 == keys.length) {\n            that.$set(data, key2, val);\n          } else {\n            if (!data[key2]) {\n              that.$set(data, key2, {});\n            }\n          }\n\n          data = data[key2];\n        });\n      });\n      callback && callback();\n    }\n  }\n};\n"],"sourceRoot":""}